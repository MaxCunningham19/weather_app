<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.11.2/qs.min.js"
    integrity="sha512-vCegEXqPUYpZsTGz2lk0jaQ1psxtFeniVJACAXhMVxuoYa/N4nZkjoVFOxLwP7uGeQOoemiz7DQrIpRTj4IBPw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"
    integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/"
    crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

<div id="app">
    <div class="container" v-if="err">
        <h1 class="row">ERRRRR :&#40;</h1>
        <p class="row">Sorry something isn"t working </p>
        <p class="row"><a href="/">Maybe try reloading?</a></p>
    </div>
    <div v-else class="container">
        <div class="row header">
            <h1>
                FuzzyForecaster
            </h1>
        </div>
        <div class="row search-container">
            <div class="row search-container">
                <input class="col-6 search-bar" :value="text" @input="event => this.searchString = event.target.value"
                    placeholder="Enter location..." />
                <button class="col-4 search-button" @click="search()">
                    Search
                </button>
                <button class="col-1 x-button align-items-end" v-if="!!weatherInfo && locationSelected"
                    @click="this.locationSelected=false">
                    X
                </button>
            </div>
            <div class="row search-results" v-if="!locationSelected" v-for="location in locations">
                <div class="row search-result" @click="show(location.lat,location.lon)">
                    <div class="row">
                        <div class="col-6">
                            {{location.name}}&nbsp;&nbsp;&nbsp;&nbsp;{{!!location.state?location.state:""}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            {{location.country}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container weather-container" v-if="!!weatherInfo && locationSelected">
            <div class="row weather-result-header">
                <div class="col-1 align-items-center">
                    Feel
                </div>
                <div class="col-3 align-items-center">Date</div>
                <div class="col-1 align-items-center">
                    &nbsp;
                </div>
                <div class="col-1 align-items-center">
                    Wind
                </div>
                <div class="col-1 align-items-center">
                    Temp
                </div>
                <div class="col-3 align-items-center">
                    Range
                </div>
                <div class="col-1 align-items-center">
                    <a
                        target=”_blank”
                        href="https://ww2.arb.ca.gov/resources/inhalable-particulate-matter-and-health#:~:text=Fine%20particulate%20matter%20is%20defined,comprises%20a%20portion%20of%20PM10.">
                        PM2.5
                        <p class="infobox">&#9072;</p>
                    </a>
                </div>
            </div>
            <div class="row weather-result align-items-center" v-for="day in weatherInfo">
                <div class="col-1 align-items-center" v-if="day.daily_info.feels_like<13.0">
                    &#129398;
                </div>
                <div class="col-1 align-items-center" v-else-if="day.daily_info.feels_like<23.0">
                    &#128526;
                </div>
                <div class="col-1 align-items-center" v-else-if="day.daily_info.feels_like>23.0">
                    &#129397;
                </div>
                <div class="col-3 align-items-center">{{day.dt_str}}</div>
                <div class="col-1 align-items-center">
                    <div v-if="day.daily_info.rain<3.8 && day.daily_info.clouds<=35">
                        &#x2600;
                    </div>
                    <div v-else-if="day.daily_info.rain<3.8 && day.daily_info.clouds>35">
                        &#x2601;
                    </div>
                    <div v-else-if="day.daily_info.rain<=6.4">
                        &#x2602;
                    </div>
                    <div v-else-if="day.daily_info.rain>6.4 && day.daily_info.rain<15.3">
                        &#x1F327;
                    </div>
                    <div v-else-if="day.daily_info.rain>=15.3">
                        &#x1F327;
                    </div>
                </div>
                <div class="col-1 align-items-center">
                    {{Math.round(day.daily_info.wind_speed*10)/10}}&nbsp;&#13224;
                </div>
                <div class="col-1 align-items-center">
                    {{Math.round(day.daily_info.average_temp)}}&deg;C
                </div>
                <div class="col-3 align-items-center">
                    {{Math.floor(day.daily_info.temp_min)}}&deg;C&nbsp;<->&nbsp;{{Math.round(day.daily_info.temp_max)}}&deg;C&nbsp;
                </div>
                <div class="col-1 align-items-center">
                    <img v-if="day.daily_info.pm2_5>10" width="30" height="18" src="/mask.png"
                        alt="facemask - poor air quality, you should wear a mask" style="background: transparent;" />
                    <img v-else width="20" height="20" src="/checkmark.png"
                        alt="green checkmark - air quality is fine no mask needed"
                        style="background: transparent; margin-left:5px;" />
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        /* Primary Colors */
        --w-1: #FFBB5C;
        --w-2: #FF9B50;
        --w-3: #E25E3E;
        --w-4: #C63D2F;
        --w-5: #FF0000;
        --w-6: #AF0404;

        --c-1: #bcd6e2;
        --c-2: #91C8E4;
        --c-3: #749BC2;
        --c-4: #4682A9;

        --b-1: #acacac;
        --b-2: #8d8d8d;
        --b-2p5: #7f7f7f;
        --b-3: #525252;
        --b-4: #313131;

        --t-l-1: #dedede;
        --t-l-2: #dedede;
        --t-l-3: #808080;
        --t-d-1: #544e4e;
        --t-d-2: #252525;
    }

    body {
        color: var(--t-l-1);
        background-color: var(--b-4);
        border-radius: 15px;
    }

    a {
        color: inherit;
        background-color: inherit;
        text-decoration: none
    }
    a:hover {
        cursor: pointer;
    }

    .header {
        color: var(--w-6)
    }

    .search-container {
        margin-bottom: 10px;
    }

    .search-result {
        margin-bottom: 5px;
        margin-top: 5px;
        border: 1px;
        border-radius: 15px;
        background-color: var(--b-3);
        border-color: var(--b-4);
    }

    .search-result:hover {
        background-color: var(--b-2p5);
        cursor: pointer;
    }

    .search-bar {
        background-color: var(--b-2);
        border-color: var(--b-3);
        color: var(--t-l-2);
        border-radius: 10px;
        margin-right: 10px;
    }

    .search-button {
        background-color: var(--b-2);
        border-color: var(--b-3);
        border-radius: 10px;
        color: var(--t-l-2);
        margin-right: 10px;
    }

    .search-bar::placeholder {
        color: var(--t-l-2)
    }

    .x-button {
        background-color: var(--b-3);
        border-color: var(--w-6);
        color: var(--w-5);
        border-radius: 10px;
        margin-right: 10px;
    }

    *:focus {
        outline: 1px;
        outline-color: var(--c-1);
    }

    .search-bar:hover {
        background-color: var(--b-2p5);
    }

    .weather-result-header {
        margin-bottom: 8px;
        color: var(--t-l-3);
        font-size: 20px;
    }

    .weather-result {
        margin-bottom: 4px;
        border-radius: 15px;
    }

    .weather-result:hover {
        margin-bottom: 4px;
        background-color: var(--b-2p5);
    }

    .infobox {
        font-size: 5px;
        float: left;
    }
</style>

<script>
    const BEURL = "http://localhost:3001/api"
    const { createApp } = Vue

    createApp({
        data() {
            return {
                searchString: "!!",
                locationSelected: false,
                locations: [],
                weatherInfo: undefined,
                err: false
            }
        },
        methods: {
            search() {
                this.locationSelected = false
                if (this.searchString == "!!") {
                    return
                }
                try {
                    axios.get(BEURL + "/locations/" + this.searchString.split(" ").join("_")).then(
                        (res) => {
                            if (!!res.data.err) {
                                this.err = true
                            }
                            this.locations = res.data.locations
                        }
                    )
                } catch (err) {
                    this.err = true
                }
            },
            show(lat, lon) {
                try {
                    axios.get(BEURL + "/weather/" + lat + "/" + lon).then(
                        (res) => {
                            if (!!res.data.err) {
                                this.err = true
                            }
                            this.weatherInfo = res.data
                            this.locationSelected = true
                        }
                    )
                } catch (err) {
                    this.err = true
                }
            }
        },
    }).mount("#app")

</script>